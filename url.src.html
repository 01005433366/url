<!doctype html>
<html lang=en-US>
<meta charset=utf-8>
<title>URL Standard</title>
<link rel=stylesheet href=//www.whatwg.org/style/specification>
<link rel=icon href=//www.whatwg.org/images/icon>

<div class=head>

<h1>URL</h1>
<h2 class="no-num no-toc">Living Standard &mdash; Last Updated [DATE: 01 Jan 1901]</h2>

<dl>
 <dt>This Version:
 <dd><a href=//url.spec.whatwg.org/>http://url.spec.whatwg.org/</a>

 <dt>Participate:</dt>
 <dd>Send feedback to
  <a href="http://www.whatwg.org/mailing-list">whatwg@whatwg.org</a>
  <!--(<a href=XXX>archives</a>)--> or
  <a href="https://www.w3.org/Bugs/Public/enter_bug.cgi?product=WebAppsWG&amp;component=URL">file a bug</a>
  (<a href="https://www.w3.org/Bugs/Public/buglist.cgi?product=WebAppsWG&amp;component=URL&amp;resolution=---">open bugs</a>)
 <dd><a href="http://wiki.whatwg.org/wiki/IRC">IRC: #whatwg on Freenode</a>

 <dt>Version History:
 <dd><a href=https://github.com/whatwg/url/commits>https://github.com/whatwg/url/commits</a></dd>

 <dt>Editor:
 <dd class="h-card vcard"><a class="u-url url p-name fn" lang="nl" href="http://annevankesteren.nl/">Anne van Kesteren</a>
  &lt;<a class="u-email email " href="mailto:annevk@annevk.nl">annevk@annevk.nl</a>>
</dl>

<script src=//dvcs.w3.org/hg/quirks-mode/raw-file/tip/file-bug.js async></script>

<p class=copyright><a rel="license" href="http://creativecommons.org/publicdomain/zero/1.0/"><img src="http://i.creativecommons.org/p/zero/1.0/80x15.png" alt="CC0"></a>
To the extent possible under law, the editors have waived all copyright and
related or neighboring rights to this work. In addition, as of
[DATE: 01 Jan 1901], the editors have made this specification available
under the
<a rel="license"
href="http://www.openwebfoundation.org/legal/the-owf-1-0-agreements/owfa-1-0">Open Web Foundation Agreement Version 1.0</a>,
which is available at
http://www.openwebfoundation.org/legal/the-owf-1-0-agreements/owfa-1-0.

</div>



<h2 class="no-num no-toc">Table of Contents</h2>
<!--toc-->



<h2 class=no-num>Goals</h2>

<p>The URL standard sets out to make URLs throughout the web platform fully
predictable and interoperable. This is the plan:

<ul>
 <li><p>Take the algorithms from RFC 3986 and RFC 3987 and align them with
 existing implementations. (E.g. spaces, other "illegal" code points, query
 encoding, equality, canonicalization, are all concepts not entirely shared,
 or defined.) URL parsing needs to become as solid as HTML parsing.
 <span data-anolis-ref>RFC3986</span>
 <span data-anolis-ref>RFC3987</span>

 <li><p>Standardize on the term URL. URI and IRI are just confusing. In
 practice a single algorithm is used for both so keeping them distinct is
 not serving anyone. URL also easily wins the search result popularity
 contest.

 <li><p>Define URL's existing JavaScript API in full detail and add
 enhancements to make it easier to work with. Add a new <code>URL</code>
 object as well for URL manipulation without usage of HTML elements. (Useful
 for Web Workers.)
</ul>

<p class=note>As the editor learns more about the subject matter the goals
might increase in scope somewhat.



<h2 class=no-num>Issues</h2>

<ul class=XXX>
 <li>Do we need to handle data URLs so they can cause the invalid flag to be
 set?
 <li>File URLs need to be special cased somehow as they behave as
 URLs with the hierarchical flag set, but have no port (and rarely a host).
</ul>



<h2>Conformance</h2>
<p>All diagrams, examples, and notes in this specification are
non-normative, as are all sections explicitly marked non-normative.
Everything else in this specification is normative.

<p>The key words "MUST", "MUST NOT", "REQUIRED", <!--"SHALL", "SHALL
NOT",--> "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and
"OPTIONAL" in the normative parts of this specification are to be
interpreted as described in RFC2119. For readability, these words do
not appear in all uppercase letters in this specification.
<span data-anolis-ref>RFC2119</span>



<h2>Terminology</h2>

<p><span data-anolis-spec=encoding>Code point</span> is not cross-referenced
throughout the specification for brevity. A string is a list of code points.

<p>The <dfn title="space character">space characters</dfn>, for the
purposes of this specification, are U+0020 SPACE, U+0009 CHARACTER
TABULATION (tab), U+000A LINE FEED (LF), U+000C FORM FEED (FF), and
U+000D CARRIAGE RETURN (CR).



<h2>Host names and IP addresses</h2>

<ul class=XXX>
 <li>Normalize IPv6 addresses
 <li>IDNA2003 vs IDNA2008 (and also UTS #46)
</ul>



<h2>URLs</h2>

<p>A <dfn title=concept-url>URL</dfn> identifies a resource. It consists of
the following components:
<dfn title=concept-url-scheme>scheme</dfn>,
<dfn title=concept-url-userinfo>userinfo</dfn>,
<dfn title=concept-url-host>host</dfn>,
<dfn title=concept-url-port>port</dfn>,
<dfn title=concept-url-path>path</dfn>,
<dfn title=concept-url-query>query</dfn>, and
<dfn title=concept-url-fragment>fragment</dfn>.

<p>A <span title=concept-url>URL</span> also has an associated
<dfn>invalid flag</dfn>, <dfn>hierarchical flag</dfn>,
<dfn title=concept-url-input>input</dfn>,
<dfn title=concept-url-base>base URL</dfn>,
and <dfn title=concept-url-query-encoding>query encoding</dfn>.

<p>To <dfn>clear</dfn> a <span title=concept-url>URL</span>, set its
<span title=concept-url-scheme>scheme</span>,
<span title=concept-url-userinfo>userinfo</span>,
<span title=concept-url-host>host</span>,
<span title=concept-url-port>port</span>,
<span title=concept-url-query>query</span>, and
<span title=concept-url-fragment>fragment</span> to the empty string, and
its <span title=concept-url-path>path</span> to the empty list.

<p>To <dfn>invalidate</dfn> a <span title=concept-url>URL</span>,
<span>clear</span> it, and then set its <span>invalid flag</span>.

<p>To make a code point <var title>c</var> <dfn>percent escaped</dfn>, run
these steps:

<ol>
 <li><p>If <var title>c</var> is greater than U+0020 and less than U+007F,
 and is not one of '<code title>"</code>', "<code title>#</code>",
 "<code title>&lt;</code>", "<code title>></code>", "<code title>?</code>",
 and "<code title>`</code>", return <var title>c</var>.

 <li><p>If <var title>c</var> is in the range U+D800 through to U+DFFF, set
 <var title>c</var> to U+FFFD.

 <li><p>Let <var title>bytes</var> be the result of running
 <span data-anolis-spec=encoding>encode</span> on <var title>c</var> using
 <span data-anolis-spec=encoding>utf-8</span> as encoding.

 <li><p>Replace each byte in <var title>bytes</var> with a string consisting
 of "<code title>%</code>" followed by a double-digit, uppercase,
 hexadecimal representation of byte, and then return them concatenated, in
 the same order.
</ol>

<p>To make a code point <var title>c</var> <dfn>query percent escaped</dfn>,
run these steps:

<ol>
 <li><p>If <var title>c</var> is greater than U+0020 and less than U+007F,
 and is not one of '<code title>"</code>', "<code title>#</code>",
 "<code title>&lt;</code>", "<code title>></code>", and
 "<code title>`</code>", return <var title>c</var>.

 <li><p>If <var title>c</var> is in the range U+D800 through to U+DFFF, set
 <var title>c</var> to U+FFFD.

 <li>
  <p>Let <var title>bytes</var> be the result of running
  <span data-anolis-spec=encoding>encode</span> on <var title>c</var> using
  <span title=concept-url-query-encoding>query encoding</span> as encoding.

  <p>Whenever the <span data-anolis-spec=encoding>encoder</span> algorithm
  emits an <span data-anolis-spec=encoding>encoder error</span>, emit a
  0x3F byte instead and do not terminate the algorithm.

 <li><p>Replace each byte in <var title>bytes</var> with a string consisting
 of "<code title>%</code>" followed by a double-digit, uppercase,
 hexadecimal representation of byte, and then return them concatenated, in
 the same order.
</ol>

<p class=note>Compared to <span>percent escaped</span> this algorithm does
not escape "<code title>?</code>" and takes the
<span title=concept-url-query-encoding>query encoding</span> into account.



<p>An <dfn>hierarchical scheme</dfn> is a
<span title=concept-url-scheme>scheme</span> listed in the first column of
the following table. It has an associated default
<span title=concept-url-port>port</span> listed in the second column on the
same row.

<table>
 <tr><th><span title=concept-url-scheme>Scheme</span>
     <th><span title=concept-url-port>Port</span>
 <tr><td>"<code title>ftp</code>"<td>21
 <tr><td>"<code title>gopher</code><td>70
 <tr><td>"<code title>http</code>"<td>80
 <tr><td>"<code title>https</code>"<td>443
 <tr><td>"<code title>ws</code>"<td>80
 <tr><td>"<code title>wss</code>"<td>443
</table>



<h3>Writing</h3>

<p class=XXX>



<h3>Creating</h3>

<p>To <dfn title=concept-url-create>create</dfn> a
<span title=concept-url>URL</span> from a string <i title>input</i>,
optionally with a <span title=concept-url>URL</span> <i title>base</i>
and an <span data-anolis-spec=encoding>encoding</span>
<i title>encoding</i>, run these steps:

<ol>
 <li><p>Let <var title>url</var> be a new
 <span title=concept-url>URL</span>.

 <li><p><span>Clear</span> <var title>url</var>.

 <li><p>If <i title>encoding</i> is not given, set it to
 <span data-anolis-spec=encoding>utf-8</span>.

 <li><p>Set <var title>url</var>'s
 <span title=concept-url-query-encoding>query encoding</span> to
 <i title>encoding</i>.

 <li><p>If <i title>base</i> is not given, set it to null.

 <li><p>Set <var title>url</var>'s
 <span title=concept-url-base>base URL</span> to <i title>base</i>.

 <li><p>Set <var title>url</var>'s
 <span title=concept-url-input>input</span> to <var title>input</var>.

 <li><p>Remove any leading and trailing
 <span title="space character">space characters</span> from
 <var title>input</var>.

 <li><p><span title=concept-url-parse>Parse</span> <var title>input</var>.

 <li><p>Return <var title>url</var>.
</ol>

<p>A <span title=concept-url>URL</span> also has an associated
<span title=concept-url-parse>parse</span> algorithm. To
<dfn title=concept-url-parse>parse</dfn> a string <var title>input</var>,
optionally with an override state <var title>override</var>, run these
steps:

<ol>
 <li><p>Let <var title>state</var> be <var title>override</var> if given, or
 <b title>scheme start</b> otherwise.

 <li><p>Let <var title>buffer</var> be the empty string.

 <li><p>Let the <var title>@ flag</var> and the <var title>[] flag</var> be
 unset.

 <li>
  <p>Run the following state machine by switching on <var title>state</var>
  for each code point in <var title>input</var>, and then once more with the
  conceptual <dfn>EOF code point</dfn>. Let the code point be
  <var title>c</var>.

  <dl class=switch>
   <dt><b title>scheme start</b>
   <dd>
    <ol>
     <li><p>If <var title>c</var> is not the <span>EOF code point</span> and
     is in the range U+0041 through to U+005A or U+0061 through to U+007A,
     append <var title>c</var>, lowercased, to <var title>buffer</var>, and
     set <var title>state</var> to <b title>scheme</b>.

     <li><p>Otherwise, if <var title>override</var> is not given, set
     <var title>buffer</var> to the empty string, set <var title>state</var>
     to <b title>no scheme</b>, and rerun this state machine for
     <var title>c</var>.

     <li><p>Otherwise, terminate this algorithm.
    </ol>

   <dt><b title>scheme</b>
   <dd>
    <ol>
     <li><p>If <var title>c</var> is not the <span>EOF code point</span> and
     is in the range U+0030 through to U+0039, U+0041 through to U+005A,
     U+0061 through to U+007A, or <var title>c</var> is
     "<code title>+</code>", "<code title>-</code>", or
     "<code title>.</code>", append <var title>c</var>, lowercased, to
     <var title>buffer</var>.

     <li>
      <p>Otherwise, if <var title>c</var> is "<code title>:</code>", set
      <span title=concept-url-scheme>scheme</span> to
      <var title>buffer</var>, <var title>buffer</var> to the empty string,
      and then run these substeps:

      <ol>
       <li><p>If <var title>override</var> is given,
       terminate this algorithm.

       <li><p>If <span title=concept-url-scheme>scheme</span> is
       an <span>hierarchical scheme</span>, set the
       <span>hierarchical flag</span>.

       <li><p>If the <span>hierarchical flag</span> is set,
       <span title=concept-url-base>base URL</span> is not null and
       <span title=concept-url-base>base URL</span>'s
       <span title=concept-url-scheme>scheme</span> is equal to
       <span title=concept-url-scheme>scheme</span>, set
       <var title>state</var> to <b title>hierarchical</b>.

       <li><p>Otherwise, if the <span>hierarchical flag</span> is set, set
       <var title>state</var> to <b title>authority start</b>.

       <li><p>Otherwise, set <var title>state</var> to <b title>path</b>.
      </ol>

     <li><p>Otherwise, set <var title>state</var> to <b title>no scheme</b>
     and start over (from the first code point in <var title>input</var>).
    </ol>

   <dt><b title>no scheme</b>
   <dd>
    <p>If <span title=concept-url-base>base URL</span> is null, or
    <span title=concept-url-base>base URL</span>'s
    <span title=concept-url-scheme>scheme</span> is not an
    <span>hierarchical scheme</span>, <span>invalidate</span>.

    <p class=note>You do not want to check
    <span title=concept-url-base>base URL</span>'s
    <span>hierarchical flag</span> here, as the
    <span title=concept-url-scheme>scheme</span> itself can have been
    changed to something non-sensical through the
    <code title=dom-URL-protocol>protocol</code> attribute.

    <p>Otherwise, set <var title>state</var> to <b title>hierarchical</b>,
    and rerun this state machine for <var title>c</var>.

   <dt><b title>hierarchical</b>
   <dd>
    <p>Let <var title>base</var> be
    <span title=concept-url-base>base URL</span>, set the
    <span>hierarchical flag</span>, and then, based on <var title>c</var>:
    <dl class=switch>
     <dt><span>EOF code point</span>
     <dd>
      <p>Set <span title=concept-url-scheme>scheme</span> to
      <var title>base</var>'s <span title=concept-url-scheme>scheme</span>,
      <span title=concept-url-host>host</span> to
      <var title>base</var>'s <span title=concept-url-host>host</span>,
      <span title=concept-url-port>port</span> to
      <var title>base</var>'s <span title=concept-url-port>port</span>,
      <span title=concept-url-path>path</span> to
      <var title>base</var>'s <span title=concept-url-path>path</span>,
      <span title=concept-url-query>query</span> to
      <var title>base</var>'s <span title=concept-url-query>query</span>,
      and then terminate these steps.

     <dt>"<code title>/</code>"
     <dt>"<code title>\</code>"
     <dd>
      <p>If the code point in <var title>input</var> after
      <var title>c</var> is either "<code title>/</code>" or
      "<code title>\</code>", set
      <span title=concept-url-scheme>scheme</span> to
      <var title>base</var>'s <span title=concept-url-scheme>scheme</span>,
      and <var title>state</var> to <b title>authority start</b>.

      <p>Otherwise, set
      <span title=concept-url-scheme>scheme</span> to
      <var title>base</var>'s <span title=concept-url-scheme>scheme</span>,
      <span title=concept-url-host>host</span> to
      <var title>base</var>'s <span title=concept-url-host>host</span>,
      <span title=concept-url-port>port</span> to
      <var title>base</var>'s <span title=concept-url-port>port</span>,
      <var title>state</var> to <b title>hierarchical path start</b>,
      and rerun this state machine for <var title>c</var>.

     <dt>"<code title>?</code>"
     <dd><p>Set <span title=concept-url-scheme>scheme</span> to
     <var title>base</var>'s <span title=concept-url-scheme>scheme</span>,
     <span title=concept-url-host>host</span> to
     <var title>base</var>'s <span title=concept-url-host>host</span>,
     <span title=concept-url-port>port</span> to
     <var title>base</var>'s <span title=concept-url-port>port</span>,
     <span title=concept-url-path>path</span> to
     <var title>base</var>'s <span title=concept-url-path>path</span>,
     <span title=concept-url-query>query</span> to "<code title>?</code>",
     and <var title>state</var> to <b title>query</b>.

     <dt>"<code title>#</code>"
     <dd><p>Set <span title=concept-url-scheme>scheme</span> to
     <var title>base</var>'s <span title=concept-url-scheme>scheme</span>,
     <span title=concept-url-host>host</span> to
     <var title>base</var>'s <span title=concept-url-host>host</span>,
     <span title=concept-url-port>port</span> to
     <var title>base</var>'s <span title=concept-url-port>port</span>,
     <span title=concept-url-path>path</span> to
     <var title>base</var>'s <span title=concept-url-path>path</span>,
     <span title=concept-url-query>query</span> to
     <var title>base</var>'s <span title=concept-url-query>query</span>,
     <span title=concept-url-fragment>fragment</span> to
     "<code title>#</code>", and <var title>state</var> to
     <b title>fragment</b>.

     <dt>Otherwise
     <dd><p>Set <span title=concept-url-scheme>scheme</span> to
     <var title>base</var>'s <span title=concept-url-scheme>scheme</span>,
     <span title=concept-url-host>host</span> to
     <var title>base</var>'s <span title=concept-url-host>host</span>,
     <span title=concept-url-port>port</span> to
     <var title>base</var>'s <span title=concept-url-port>port</span>,
     <span title=concept-url-path>path</span> to
     <var title>base</var>'s <span title=concept-url-path>path</span>, then
     remove <span title=concept-url-path>path</span>'s last string, set
     <var title>state</var> to <b title>hierarchical path start</b>,
     and rerun this state machine for <var title>c</var>.
    </dl>

   <dt><b title>authority start</b>
   <dd><p>If <var title>c</var> is neither "<code title>/</code>" nor
   "<code title>\</code>", set <var title>state</var> to
   <b title>authority</b>, and rerun this state machine for
   <var title>c</var>.

   <dt><b title>authority</b>
   <dd>
    <p>Based on <var title>c</var>:
    <dl class=switch>
     <dt>"<code title>@</code>"
     <dd>
      <ol>
       <li><p>If the <var title>@ flag</var> is set, append
       "<code title>%40</code>" to
       <span title=concept-url-userinfo>userinfo</span>.

       <li><p>Set the <var title>@ flag</var>.

       <li><p>Append each code point in <var title>buffer</var>,
       <span>percent escaped</span>, to
       <span title=concept-url-userinfo>userinfo</span>

       <li><p>Set <var title>buffer</var> to the empty string.
      </ol>
     <dt><span>EOF code point</span>
     <dt>"<code title>/</code>"
     <dt>"<code title>\</code>"
     <dt>"<code title>?</code>"
     <dt>"<code title>#</code>"
     <dd><p>Rerun this state machine for all code points in
     <var title>buffer</var>, set <var title>buffer</var> to the empty
     string, and <var title>state</var> to <b title>host</b>.

     <dt>Otherwise
     <dd><p>Append <var title>c</var> to <var title>buffer</var>.
    </dl>

   <dt><b title>host</b>
   <dt><b title>hostname</b>
   <dd>
    <ol>
     <li><p>If <var title>c</var> is "<code title>:</code>" and
     the <var title>[] flag</var> is unset, set
     <span title=concept-url-host>host</span> to <var title>buffer</var>,
     <!-- XXX host normalize -->
     <var title>buffer</var> to the empty string, <var title>state</var>
     to <b title>port</b>, and then only if <var title>override</var> is
     <b title>hostname</b>, terminate these steps.

     <li><p>Otherwise, if <var title>c</var> is one of
     <span>EOF code point</span>, "<code title>/</code>",
     "<code title>\</code>", "<code title>?</code>", or
     "<code title>#</code>", set
     <span title=concept-url-host>host</span> to <var title>buffer</var>,
     <!-- XXX host normalize -->
     <var title>buffer</var> to the empty string, <var title>state</var>
     to <b title>hierarchical path start</b>, and then only if
     <var title>override</var> is given, terminate these steps, or otherwise
     rerun this state machine for <var title>c</var>.

     <li>
      <p>Otherwise, if <var title>c</var> is none of U+0009, U+000A, and
      U+000D, run these substeps:

      <ol>
       <li><p>If <var title>c</var> is "<code title>[</code>", set the
       <var title>[] flag</var>.

       <li><p>If <var title>c</var> is "<code title>]</code>", unset the
       <var title>[] flag</var>.

       <li><p>Append <var title>c</var> to <var title>buffer</var>.
      </ol>
    </ol>

   <dt><b title>port</b>
   <dd>
    <ol>
     <li><p>If <var title>c</var> is in the range U+0030 through to U+0039,
     append <var title>c</var> to <var title>buffer</var>.

     <li>
      <p>Otherwise, if <var title>c</var> is one of
      <span>EOF code point</span>, "<code title>/</code>",
      "<code title>\</code>", "<code title>?</code>", or
      "<code title>#</code>", or <var title>override</var> is given, run
      these substeps:
      <ol>
       <li><p class=XXX>parse buffer and set port

       <li><p>If <var title>override</var> is given, terminate this
       algorithm.

       <li><p>Set <var title>buffer</var> to the empty string,
       <var title>state</var> to <b title>hierarchical path start</b>, and
       rerun this state machine for <var title>c</var>.
      </ol>

     <li><p>Otherwise, <span>invalidate</span>.
    </ol>

   <dt><b title>path</b>
   <dd>
    <ol>
     <li><p>Append an empty string to
     <span title=concept-url-path>path</span>.

     <li><p>If <var title>override</var> is not given and <var title>c</var>
     is "<code title>#</code>", set
     <span title=concept-url-fragment>fragment</span> to
     "<code title>#</code>" and <var title>state</var> to
     <b title>fragment</b>.

     <li><p>Otherwise, if <var title>c</var> is not the
     <span>EOF code point</span>, append <var title>c</var>,
     <span>percent escaped</span>, to the only string in
     <span title=concept-url-path>path</span>.
    </ol>

   <dt><b title>hierarchical path start</b>
   <dd><p>Set <var title>state</var> to <b title>hierarchical path</b> and
   if <var title>c</var> is neither "<code title>/</code>" nor
   "<code title>\</code>", rerun this state machine for <var title>c</var>.

   <dt><b title>hierarchical path</b>
   <dd>
    <ol>
     <li>
      <p>If either <var title>c</var> is one of
      <span>EOF code point</span>, "<code title>/</code>", and
      "<code title>\</code>", or <var title>override</var> is not given and
      <var title>c</var> is "<code title>?</code>" or
      "<code title>#</code>", run these substeps:
      <ol>
       <li><p>If <var title>buffer</var> is "<code title>..</code>" and
       <var title>c</var> is one of <span>EOF code point</span>,
       "<code title>/</code>", and "<code title>\</code>", set the last
       string in <span title=concept-url-path>path</span> to the empty
       string.

       <li><p>Otherwise, if <var title>buffer</var> is
       "<code title>..</code>", remove the last string from
       <span title=concept-url-path>path</span>.

       <li><p>Otherwise, if <var title>buffer</var> is
       "<code title>.</code>" and <var title>c</var> is one of
       <span>EOF code point</span>, "<code title>/</code>", and
       "<code title>\</code>", append an empty string to
       <span title=concept-url-path>path</span>.

       <li><p>Otherwise, if <var title>buffer</var> is not
       "<code title>.</code>", append <var title>buffer</var> to
       <span title=concept-url-path>path</span>.

       <li><p>Set <var title>buffer</var> to the empty string.

       <li><p>If <var title>c</var> is "<code title>?</code>", set
       <span title=concept-url-query>query</span> to "<code title>?</code>",
       and <var title>state</var> to <b title>query</b>.

       <li><p>If <var title>c</var> is "<code title>#</code>", set
       <span title=concept-url-fragment>fragment</span> to
       "<code title>#</code>", and <var title>state</var> to
       <b title>fragment</b>.
      </ol>

     <li><p>Otherwise, if <var title>c</var> is none of U+0009, U+000A, and
     U+000D, append <var title>c</var>, <span>percent escaped</span>, to
     <var title>buffer</var>.
    </ol>

   <dt><b title>query</b>
   <dd>
    <ol>
     <li><p>If <var title>override</var> is not given and <var title>c</var>
     is "<code title>#</code>", set
     <span title=concept-url-fragment>fragment</span> to
     "<code title>#</code>", and state to <b title>fragment</b>.

     <li><p>Otherwise, if <var title>c</var> is none of U+0009, U+000A, and
     U+000D, append <var title>c</var>, <span>query percent escaped</span>,
     to <span title=concept-url-query>query</span>.
    </ol>

   <dt><b title>fragment</b>
   <dd><p>If <var title>c</var> is none of U+0009, U+000A, and U+000D,
   append <var title>c</var>, <span>percent escaped</span>, to
   <span title=concept-url-fragment>fragment</span>.
  </dl>
</ol>



<h3>API</h3>

<pre class=idl>[<span title=dom-URL>Constructor</span>(DOMString <var title>url</var>, optional (<span>URL</span> or DOMString)? <var title>base</var> = null)]
interface <dfn>URL</dfn> {

};
<span>URL</span> implements <span>URLUtils</span>;

[NoInterfaceObject]
interface <dfn>URLUtils</dfn> {
  stringifier attribute DOMString <span title=dom-URL-href>href</span>;
  readonly attribute DOMString <span title=dom-URL-origin>origin</span>;

           attribute DOMString <span title=dom-URL-protocol>protocol</span>;
           attribute DOMString <span title=dom-URL-host>host</span>;
           attribute DOMString <span title=dom-URL-hostname>hostname</span>;
           attribute DOMString <span title=dom-URL-port>port</span>;
           attribute DOMString <span title=dom-URL-pathname>pathname</span>;
           attribute DOMString <span title=dom-URL-search>search</span>;
           attribute DOMString <span title=dom-URL-hash>hash</span>;

  readonly attribute boolean <span title=dom-URL-isInvalid>isInvalid</span>;
}</pre>

<p>Any object implementing <code>URLUtils</code> represents a
<span title=concept-url>URL</span>. Thus <code>URL</code> represents a
<span title=concept-url>URL</span>.

<p class=note>The <code>URL</code> object and
<span title=concept-url>URL</span> share the same name because nothing else
makes much sense and when it comes down to it almost nobody cares.


<h4>Constructor</h4>

<p>The
<dfn title=dom-URL><code>URL(<var title>url</var> [, <var title>base</var>])</code></dfn>
constructor must run these steps:

<ol>
 <li><p>If <var title>base</var> is a string,
 <span title=concept-url-create>create</span> a
 <span title=concept-url>URL</span> from <var title>base</var> and set
 <var title>base</var> to the result of that algorithm.

 <li><p>If <var title>base</var> is not null and its
 <span>invalid flag</span> is set, throw a
 "<code data-anolis-spec=dom>InvalidStateError</code>".

 <li><p><span title=concept-url-create>Create</span> a
 <span title=concept-url>URL</span> from <var title>url</var> with
 <var title>base</var> as <i title>base</i>, associate it with a new
 <code>URL</code> object, and then return that <code>URL</code> object.
</ol>


<h4><code>URLUtils</code> members</h4>

<p>The <dfn title=dom-URL-href><code>href</code></dfn> attribute must run
these steps:

<ol>
 <li><p>If the <span>invalid flag</span> is set, return
 <span title=concept-url-input>input</span>.

 <li><p>Let <var title>output</var> be
 <span title=concept-url-scheme>scheme</span> and "<code title>:</code>"
 concatenated.

 <li>
  <p>If the <span>hierarchical flag</span> is set:

  <ol>
   <li><p>Append "<code title>//</code>" to <var title>output</var>.

   <li><p>If <span title=concept-url-userinfo>userinfo</span> is not the
   empty string, append <span title=concept-url-userinfo>userinfo</span> and
   "<code title>@</code>" concatenated to <var title>output</var>.

   <li><p>Append <span title=concept-url-host>host</span> to
   <var title>output</var>.

   <li><p>If <span title=concept-url-port>port</span> is not
   the empty string, append "<code title>:</code>" and
   <span title=concept-url-port>port</span> concatenated to
   <var title>output</var>.
  </ol>

 <li><p class=XXX>path

 <li><p>Append <span title=concept-url-query>query</span> and
 <span title=concept-url-fragment>fragment</span> concatenated to
 <var title>output</var>, and then return <var title>output</var>.
</ol>

<p>Setting the <code title=dom-URL-href>href</code> attribute must
run these steps:

<ol>
 <li><p><span>Clear</span>.

 <li><p><span title=concept-url-parse>Parse</span> with the given value as
 <i title>input</i>.
</ol>

<p>The <dfn title=dom-URL-origin><code>origin</code></dfn> attribute must
return the <span data-anolis-spec=origin>Unicode serialization</span> of
the <span title=concept-url>URL</span>'s
<span data-anolis-spec=origin>origin</span>.
<span data-anolis-ref>ORIGIN</span>

<p class=note>It returns the Unicode rather than the ASCII serialization for
compatibility with HTML's <code>MessageEvent</code> feature.
<span data-anolis-ref class=informative>HTML</span>

<p>The <dfn title=dom-URL-protocol><code>protocol</code></dfn> attribute
must return <span title=concept-url-scheme>scheme</span> and
"<code title>:</code>" concatenated.

<p class=note>In case the <span>invalid flag</span> is set this will cause
it to return "<code title>:</code>".

<p>Setting the <code title=dom-URL-protocol>protocol</code> attribute must
run these steps:

<ol>
 <li><p>If the <span>invalid flag</span> is set, terminate these steps.

 <li><p><span title=concept-url-parse>Parse</span> with the given value and
 "<code title>:</code>" concatenated as <i title>input</i> and
 <b title>scheme start</b> as <i title>override</i>.
</ol>

<p>The <dfn title=dom-URL-host><code>host</code></dfn> attribute must run
these steps:

<ol>
 <li><p>If the <span>invalid flag</span> is set, return the empty string.

 <li><p>If <span title=concept-url-port>port</span> is the empty string,
 return <span title=concept-url-host>host</span>.

 <li><p>Return <span title=concept-url-host>host</span>,
 "<code title>:</code>", and <span title=concept-url-port>port</span>
 concatenated.
</ol>

<p>Setting the <code title=dom-URL-host>host</code> attribute must run these
steps:

<ol>
 <li><p>If the <span>invalid flag</span> is set, or the
 <span>hierarchical flag</span> is unset, terminate these steps.

 <li><p><span title=concept-url-parse>Parse</span> with the given value as
 <i title>input</i> and <b title>host</b> as <i title>override</i>.
</ol>

<p>The <dfn title=dom-URL-hostname><code>hostname</code></dfn> attribute
must return <span title=concept-url-host>host</span>.

<p>Setting the <code title=dom-URL-hostname>hostname</code> attribute must
run these steps:

<ol>
 <li><p>If the <span>invalid flag</span> is set, or the
 <span>hierarchical flag</span> is unset, terminate these steps.

 <li><p><span title=concept-url-parse>Parse</span> with the given value as
 <i title>input</i> and <b title>hostname</b> as <i title>override</i>.
</ol>

<p>The <dfn title=dom-URL-port><code>port</code></dfn> attribute must return
<span title=concept-url-port>port</span>.

<p>Setting the <code title=dom-URL-port>port</code> attribute must run these
steps:

<ol>
 <li><p>If the <span>invalid flag</span> is set, or the
 <span>hierarchical flag</span> is unset, terminate these steps.

 <li><p><span title=concept-url-parse>Parse</span> with the given value as
 <i title>input</i> and <b title>port</b> as <i title>override</i>.
</ol>

<p class=XXX>pathname

<p>The <dfn title=dom-URL-search><code>search</code></dfn> attribute must
run these steps:

<ol>
 <li><p>If the <span>invalid flag</span> is set, or
 <span title=concept-url-query>query</span> is either the empty string or
 "<code title>?</code>", return the empty string.

 <li><p>Return <span title=concept-url-query>query</span>.
</ol>

<p>Setting the <code title=dom-URL-search>search</code> attribute must run
these steps:

<ol>
 <li><p>If the <span>invalid flag</span> is set, or the
 <span>hierarchical flag</span> is unset, terminate these steps.

 <li><p>Let <var title>input</var> be the given value with a single leading
 "<code title>?</code>" removed, if any.

 <li><p><span title=concept-url-parse>Parse</span> with
 <var title>input</var> as <i title>input</i> and <b title>query</b> as
 <i title>override</i>.
</ol>

<p>The <dfn title=dom-URL-hash><code>hash</code></dfn> attribute must run
these steps:

<ol>
 <li><p>If the <span>invalid flag</span> is set, or
 <span title=concept-url-fragment>fragment</span> is either the empty string
 or "<code title>#</code>", return the empty string.

 <li><p>Return <span title=concept-url-fragment>fragment</span>.
</ol>

<p>Setting the <code title=dom-URL-hash>hash</code> attribute must run these
steps:

<ol>
 <li><p>If the <span>invalid flag</span> is set, or the
 <span>hierarchical flag</span> is unset, terminate these steps.

 <li><p>Let <var title>input</var> be the given value with a single leading
 "<code title>#</code>" removed, if any.

 <li><p><span title=concept-url-parse>Parse</span> with
 <var title>input</var> as <i title>input</i> and <b title>fragment</b> as
 <i title>override</i>.
</ol>

<p>The <dfn title=dom-URL-isInvalid><code>isInvalid</code></dfn> attribute
must return true if the <span>invalid flag</span> is set, or false
otherwise.



<h2 class=no-num>References</h2>
<div id=anolis-references></div>



<h2 class=no-num>Acknowledgments</h2>

<p>Thanks to
Alexandre Morgaut,
Glenn Maynard,
James Graham, and
Simon Pieters
for being awesome!



<script id=head src=http://www.whatwg.org/specs/web-apps/current-work/dfn.js></script>
