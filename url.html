<!DOCTYPE html><html lang="en-US"><meta charset="utf-8">
<title>URL Standard</title>
<link href="//www.whatwg.org/style/specification" rel="stylesheet">
<link href="//www.whatwg.org/images/icon" rel="icon">

<div class="head">

<h1>URL</h1>
<h2 class="no-num no-toc" id="living-standard-—-last-updated-19-october-2012">Living Standard — Last Updated 19 October 2012</h2>

<dl>
 <dt>This Version:
 <dd><a href="//url.spec.whatwg.org/">http://url.spec.whatwg.org/</a>

 <dt>Participate:</dt>
 <dd>Send feedback to
  <a href="http://www.whatwg.org/mailing-list">whatwg@whatwg.org</a>
  <!--(<a href=XXX>archives</a>)--> or
  <a href="https://www.w3.org/Bugs/Public/enter_bug.cgi?product=WHATWG&amp;component=URL">file a bug</a>
  (<a href="https://www.w3.org/Bugs/Public/buglist.cgi?product=WHATWG&amp;component=URL&amp;resolution=---">open bugs</a>)
 <dd><a href="http://wiki.whatwg.org/wiki/IRC">IRC: #whatwg on Freenode</a>

 <dt>Version History:
 <dd><a href="https://github.com/whatwg/url/commits">https://github.com/whatwg/url/commits</a></dd>

 <dt>Editor:
 <dd class="h-card vcard"><a class="u-url url p-name fn" href="http://annevankesteren.nl/" lang="nl">Anne van Kesteren</a>
  &lt;<a class="u-email email " href="mailto:annevk@annevk.nl">annevk@annevk.nl</a>&gt;
</dl>

<script async="" src="//dvcs.w3.org/hg/quirks-mode/raw-file/tip/file-bug.js"></script>

<p class="copyright"><a href="http://creativecommons.org/publicdomain/zero/1.0/" rel="license"><img alt="CC0" src="http://i.creativecommons.org/p/zero/1.0/80x15.png"></a>
To the extent possible under law, the editors have waived all copyright and
related or neighboring rights to this work. In addition, as of
19 October 2012, the editors have made this specification available
under the
<a href="http://www.openwebfoundation.org/legal/the-owf-1-0-agreements/owfa-1-0" rel="license">Open Web Foundation Agreement Version 1.0</a>,
which is available at
http://www.openwebfoundation.org/legal/the-owf-1-0-agreements/owfa-1-0.

</div>



<h2 class="no-num no-toc" id="table-of-contents">Table of Contents</h2>

<!--begin-toc-->
<ol class="toc">
 <li><a class="no-num" href="#goals">Goals</a></li>
 <li><a class="no-num" href="#issues">Issues</a></li>
 <li><a href="#conformance"><span class="secno">1 </span>Conformance</a></li>
 <li><a href="#terminology"><span class="secno">2 </span>Terminology</a></li>
 <li><a href="#host-names-and-ip-addresses"><span class="secno">3 </span>Host names and IP addresses</a></li>
 <li><a href="#urls"><span class="secno">4 </span>URLs</a>
  <ol>
   <li><a href="#writing"><span class="secno">4.1 </span>Writing</a></li>
   <li><a href="#parsing"><span class="secno">4.2 </span>Parsing</a></ol></li>
 <li><a href="#api"><span class="secno">5 </span>API</a>
  <ol>
   <li><a href="#constructors"><span class="secno">5.1 </span>Constructors</a></li>
   <li><a href="#interface-urlutils"><span class="secno">5.2 </span>Interface <code title="">URLUtils</code></a></li>
   <li><a href="#interface-urlquery"><span class="secno">5.3 </span>Interface <code title="">URLQuery</code></a></ol></li>
 <li><a class="no-num" href="#references">References</a></li>
 <li><a class="no-num" href="#acknowledgments">Acknowledgments</a></ol>
<!--end-toc-->



<h2 class="no-num" id="goals">Goals</h2>

<p>The URL standard sets out to make URLs throughout the web platform fully
predictable and interoperable. This is the plan:

<ul>
 <li><p>Take the algorithms from RFC 3986 and RFC 3987 and align them with
 existing implementations. (E.g. spaces, other "illegal" code points, query
 encoding, equality, canonicalization, are all concepts not entirely shared,
 or defined.) URL parsing needs to become as solid as HTML parsing.
 <a href="#refsRFC3986">[RFC3986]</a>
 <a href="#refsRFC3987">[RFC3987]</a>

 <li><p>Standardize on the term URL. URI and IRI are just confusing. In
 practice a single algorithm is used for both so keeping them distinct is
 not serving anyone. URL also easily wins the search result popularity
 contest.

 <li><p>Define URL's existing JavaScript API in full detail and add
 enhancements to make it easier to work with. Add a new <a href="#url"><code>URL</code></a>
 object as well for URL manipulation without usage of HTML elements. (Useful
 for Web Workers.)
</ul>

<p class="note">As the editor learns more about the subject matter the goals
might increase in scope somewhat.



<h2 class="no-num" id="issues">Issues</h2>

<ul class="XXX">
 <li>Do we need to handle data URLs so they can cause the invalid flag to be
 set?
 <li>File URLs need to be special cased somehow as they behave as
 URLs with the hierarchical flag set, but have no port (and rarely a host).
</ul>



<h2 id="conformance"><span class="secno">1 </span>Conformance</h2>
<p>All diagrams, examples, and notes in this specification are
non-normative, as are all sections explicitly marked non-normative.
Everything else in this specification is normative.

<p>The key words "MUST", "MUST NOT", "REQUIRED", <!--"SHALL", "SHALL
NOT",--> "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and
"OPTIONAL" in the normative parts of this specification are to be
interpreted as described in RFC2119. For readability, these words do
not appear in all uppercase letters in this specification.
<a href="#refsRFC2119">[RFC2119]</a>



<h2 id="terminology"><span class="secno">2 </span>Terminology</h2>

<p>Some terms used in this specification are defined in the
Encoding Standard. <a href="#refsENCODING">[ENCODING]</a>



<h2 id="host-names-and-ip-addresses"><span class="secno">3 </span>Host names and IP addresses</h2>

<ul class="XXX">
 <li>Normalize IPv6 addresses
 <li>IDNA2003 vs IDNA2008 (and also UTS #46)
</ul>



<h2 id="urls"><span class="secno">4 </span>URLs</h2>

<p>A <dfn id="concept-url" title="concept-url">URL</dfn> identifies a resource. It consists of
the following components:
<dfn id="concept-url-scheme" title="concept-url-scheme">scheme</dfn>,
<dfn id="concept-url-userinfo" title="concept-url-userinfo">userinfo</dfn>,
<dfn id="concept-url-host" title="concept-url-host">host</dfn>,
<dfn id="concept-url-port" title="concept-url-port">port</dfn>,
<dfn id="concept-url-path" title="concept-url-path">path</dfn>,
<dfn id="concept-url-query" title="concept-url-query">query</dfn>, and
<dfn id="concept-url-fragment" title="concept-url-fragment">fragment</dfn>.

<p>A <a href="#concept-url" title="concept-url">URL</a> also has an associated
<dfn id="invalid-flag">invalid flag</dfn>, <dfn id="hierarchical-flag">hierarchical flag</dfn>,
<dfn id="concept-url-input" title="concept-url-input">input</dfn>,
<dfn id="concept-url-base" title="concept-url-base">base URL</dfn>,
and <dfn id="concept-url-query-encoding" title="concept-url-query-encoding">query encoding</dfn>.

<p>To <dfn id="clear">clear</dfn> a <a href="#concept-url" title="concept-url">URL</a>, set its
<a href="#concept-url-scheme" title="concept-url-scheme">scheme</a>,
<a href="#concept-url-userinfo" title="concept-url-userinfo">userinfo</a>,
<a href="#concept-url-host" title="concept-url-host">host</a>,
<a href="#concept-url-port" title="concept-url-port">port</a>,
<a href="#concept-url-query" title="concept-url-query">query</a>, and
<a href="#concept-url-fragment" title="concept-url-fragment">fragment</a> to the empty string, and
its <a href="#concept-url-path" title="concept-url-path">path</a> to the empty list.

<p>To <dfn id="invalidate">invalidate</dfn> a <a href="#concept-url" title="concept-url">URL</a>,
<a href="#clear">clear</a> it, and then set its <a href="#invalid-flag">invalid flag</a>.

<p>To make a code point <var title="">c</var> <dfn id="percent-escaped">percent escaped</dfn>, run
these steps:

<ol>
 <li><p>If <var title="">c</var> is greater than U+0020 and less than U+007F,
 and is not one of '<code title="">"</code>', "<code title="">#</code>",
 "<code title="">&lt;</code>", "<code title="">&gt;</code>", "<code title="">?</code>",
 and "<code title="">`</code>", return <var title="">c</var>.

 <li><p>If <var title="">c</var> is in the range U+D800 through to U+DFFF, set
 <var title="">c</var> to U+FFFD.

 <li><p>Let <var title="">bytes</var> be the result of running
 <a class="external" data-anolis-spec="encoding" href="http://encoding.spec.whatwg.org/#encode">encode</a> on <var title="">c</var> using
 <a class="external" data-anolis-spec="encoding" href="http://encoding.spec.whatwg.org/#utf-8">utf-8</a> as encoding.

 <li><p>Replace each byte in <var title="">bytes</var> with a string consisting
 of "<code title="">%</code>" followed by a double-digit, uppercase,
 hexadecimal representation of byte, and then return them concatenated, in
 the same order.
</ol>

<p>To make a code point <var title="">c</var> <dfn id="query-percent-escaped">query percent escaped</dfn>,
run these steps:

<ol>
 <li><p>If <var title="">c</var> is greater than U+0020 and less than U+007F,
 and is not one of '<code title="">"</code>', "<code title="">#</code>",
 "<code title="">&lt;</code>", "<code title="">&gt;</code>", and
 "<code title="">`</code>", return <var title="">c</var>.

 <li><p>If <var title="">c</var> is in the range U+D800 through to U+DFFF, set
 <var title="">c</var> to U+FFFD.

 <li>
  <p>Let <var title="">bytes</var> be the result of running
  <a class="external" data-anolis-spec="encoding" href="http://encoding.spec.whatwg.org/#encode">encode</a> on <var title="">c</var> using
  <a href="#concept-url-query-encoding" title="concept-url-query-encoding">query encoding</a> as encoding.

  <p>Whenever the <a class="external" data-anolis-spec="encoding" href="http://encoding.spec.whatwg.org/#encoder">encoder</a> algorithm
  emits an <a class="external" data-anolis-spec="encoding" href="http://encoding.spec.whatwg.org/#encoder-error">encoder error</a>, emit a
  0x3F byte instead and do not terminate the algorithm.

 <li><p>Replace each byte in <var title="">bytes</var> with a string consisting
 of "<code title="">%</code>" followed by a double-digit, uppercase,
 hexadecimal representation of byte, and then return them concatenated, in
 the same order.
</ol>

<p class="note">Compared to <a href="#percent-escaped">percent escaped</a> this algorithm does
not escape "<code title="">?</code>" and takes the
<a href="#concept-url-query-encoding" title="concept-url-query-encoding">query encoding</a> into account.



<p>An <dfn id="hierarchical-scheme">hierarchical scheme</dfn> is a
<a href="#concept-url-scheme" title="concept-url-scheme">scheme</a> listed in the first column of
the following table. It has an associated default
<a href="#concept-url-port" title="concept-url-port">port</a> listed in the second column on the
same row.

<table>
 <tr><th><a href="#concept-url-scheme" title="concept-url-scheme">Scheme</a>
     <th><a href="#concept-url-port" title="concept-url-port">Port</a>
 <tr><td>"<code title="">ftp</code>"<td>21
 <tr><td>"<code title="">gopher</code>"<td>70
 <tr><td>"<code title="">http</code>"<td>80
 <tr><td>"<code title="">https</code>"<td>443
 <tr><td>"<code title="">ws</code>"<td>80
 <tr><td>"<code title="">wss</code>"<td>443
</table>



<h3 id="writing"><span class="secno">4.1 </span>Writing</h3>

<p class="XXX">



<h3 id="parsing"><span class="secno">4.2 </span>Parsing</h3>

<p>To <dfn id="concept-url-parse" title="concept-url-parse">parse</dfn> a string <i title="">input</i>,
optionally with a <a href="#concept-url" title="concept-url">URL</a> <i title="">base</i>
and an <a class="external" data-anolis-spec="encoding" href="http://encoding.spec.whatwg.org/#encoding">encoding</a>
<i title="">encoding</i>, run these steps:

<ol>
 <li><p>Let <var title="">url</var> be a new
 <a href="#concept-url" title="concept-url">URL</a>.

 <li><p><a href="#clear">Clear</a> <var title="">url</var>.

 <li><p>If <i title="">encoding</i> is not given, set it to
 <a class="external" data-anolis-spec="encoding" href="http://encoding.spec.whatwg.org/#utf-8">utf-8</a>.

 <li><p>Set <var title="">url</var>'s
 <a href="#concept-url-query-encoding" title="concept-url-query-encoding">query encoding</a> to
 <i title="">encoding</i>.

 <li><p>If <i title="">base</i> is not given, set it to null.

 <li><p>Set <var title="">url</var>'s
 <a href="#concept-url-base" title="concept-url-base">base URL</a> to <i title="">base</i>.

 <li><p>Set <var title="">url</var>'s
 <a href="#concept-url-input" title="concept-url-input">input</a> to <var title="">input</var>.

 <li><p>Remove any leading and trailing
 <a class="external" data-anolis-spec="encoding" href="http://encoding.spec.whatwg.org/#space-characters">space characters</a> from
 <var title="">input</var>.

 <li><p><a href="#concept-url-interpret" title="concept-url-interpret">Interpret</a>
 <var title="">input</var>.

 <li><p>Return <var title="">url</var>.
</ol>

<p>A <a href="#concept-url" title="concept-url">URL</a> also has an associated
<a href="#concept-url-interpret" title="concept-url-interpret">interpret</a> algorithm. To
<dfn id="concept-url-interpret" title="concept-url-interpret">interpret</dfn> a string
<var title="">input</var>, optionally with an override state
<var title="">override</var>, run these steps:

<ol>
 <li><p>Let <var title="">state</var> be <var title="">override</var> if given, or
 <b title="">scheme start</b> otherwise.

 <li><p>Let <var title="">buffer</var> be the empty string.

 <li><p>Let the <var title="">@ flag</var> and the <var title="">[] flag</var> be
 unset.

 <li>
  <p>Run the following state machine by switching on <var title="">state</var>
  for each code point in <var title="">input</var>, and then once more with the
  conceptual <dfn id="eof-code-point">EOF code point</dfn>. Let the code point be
  <var title="">c</var>.

  <dl class="switch">
   <dt><b title="">scheme start</b>
   <dd>
    <ol>
     <li><p>If <var title="">c</var> is not the <a href="#eof-code-point">EOF code point</a> and
     is in the range U+0041 through to U+005A or U+0061 through to U+007A,
     append <var title="">c</var>, lowercased, to <var title="">buffer</var>, and
     set <var title="">state</var> to <b title="">scheme</b>.

     <li><p>Otherwise, if <var title="">override</var> is not given, set
     <var title="">buffer</var> to the empty string, set <var title="">state</var>
     to <b title="">no scheme</b>, and rerun this state machine for
     <var title="">c</var>.

     <li><p>Otherwise, terminate this algorithm.
    </ol>

   <dt><b title="">scheme</b>
   <dd>
    <ol>
     <li><p>If <var title="">c</var> is not the <a href="#eof-code-point">EOF code point</a> and
     is in the range U+0030 through to U+0039, U+0041 through to U+005A,
     U+0061 through to U+007A, or <var title="">c</var> is
     "<code title="">+</code>", "<code title="">-</code>", or
     "<code title="">.</code>", append <var title="">c</var>, lowercased, to
     <var title="">buffer</var>.

     <li>
      <p>Otherwise, if <var title="">c</var> is "<code title="">:</code>", set
      <a href="#concept-url-scheme" title="concept-url-scheme">scheme</a> to
      <var title="">buffer</var>, <var title="">buffer</var> to the empty string,
      and then run these substeps:

      <ol>
       <li><p>If <var title="">override</var> is given,
       terminate this algorithm.

       <li><p>If <a href="#concept-url-scheme" title="concept-url-scheme">scheme</a> is
       an <a href="#hierarchical-scheme">hierarchical scheme</a>, set the
       <a href="#hierarchical-flag">hierarchical flag</a>.

       <li><p>If the <a href="#hierarchical-flag">hierarchical flag</a> is set,
       <a href="#concept-url-base" title="concept-url-base">base URL</a> is not null and
       <a href="#concept-url-base" title="concept-url-base">base URL</a>'s
       <a href="#concept-url-scheme" title="concept-url-scheme">scheme</a> is equal to
       <a href="#concept-url-scheme" title="concept-url-scheme">scheme</a>, set
       <var title="">state</var> to <b title="">hierarchical</b>.

       <li><p>Otherwise, if the <a href="#hierarchical-flag">hierarchical flag</a> is set, set
       <var title="">state</var> to <b title="">authority start</b>.

       <li><p>Otherwise, set <var title="">state</var> to <b title="">path</b>.
      </ol>

     <li><p>Otherwise, set <var title="">state</var> to <b title="">no scheme</b>,
     <var title="">buffer</var> to the empty string, and start over (from the
     first code point in <var title="">input</var>).
    </ol>

   <dt><b title="">no scheme</b>
   <dd>
    <p>If <a href="#concept-url-base" title="concept-url-base">base URL</a> is null, or
    <a href="#concept-url-base" title="concept-url-base">base URL</a>'s
    <a href="#concept-url-scheme" title="concept-url-scheme">scheme</a> is not an
    <a href="#hierarchical-scheme">hierarchical scheme</a>, <a href="#invalidate">invalidate</a>.

    <p class="note">You do not want to check
    <a href="#concept-url-base" title="concept-url-base">base URL</a>'s
    <a href="#hierarchical-flag">hierarchical flag</a> here, as the
    <a href="#concept-url-scheme" title="concept-url-scheme">scheme</a> itself can have been
    changed to something non-sensical through the
    <a href="#dom-url-protocol"><code title="dom-URL-protocol">protocol</code></a> attribute.

    <p>Otherwise, set <var title="">state</var> to <b title="">hierarchical</b>,
    and rerun this state machine for <var title="">c</var>.

   <dt><b title="">hierarchical</b>
   <dd>
    <p>Let <var title="">base</var> be
    <a href="#concept-url-base" title="concept-url-base">base URL</a>, set the
    <a href="#hierarchical-flag">hierarchical flag</a>, and then, based on <var title="">c</var>:
    <dl class="switch">
     <dt><a href="#eof-code-point">EOF code point</a>
     <dd>
      <p>Set <a href="#concept-url-scheme" title="concept-url-scheme">scheme</a> to
      <var title="">base</var>'s <a href="#concept-url-scheme" title="concept-url-scheme">scheme</a>,
      <a href="#concept-url-host" title="concept-url-host">host</a> to
      <var title="">base</var>'s <a href="#concept-url-host" title="concept-url-host">host</a>,
      <a href="#concept-url-port" title="concept-url-port">port</a> to
      <var title="">base</var>'s <a href="#concept-url-port" title="concept-url-port">port</a>,
      <a href="#concept-url-path" title="concept-url-path">path</a> to
      <var title="">base</var>'s <a href="#concept-url-path" title="concept-url-path">path</a>,
      <a href="#concept-url-query" title="concept-url-query">query</a> to
      <var title="">base</var>'s <a href="#concept-url-query" title="concept-url-query">query</a>,
      and then terminate these steps.

     <dt>"<code title="">/</code>"
     <dt>"<code title="">\</code>"
     <dd>
      <p>If the code point in <var title="">input</var> after
      <var title="">c</var> is either "<code title="">/</code>" or
      "<code title="">\</code>", set
      <a href="#concept-url-scheme" title="concept-url-scheme">scheme</a> to
      <var title="">base</var>'s <a href="#concept-url-scheme" title="concept-url-scheme">scheme</a>,
      and <var title="">state</var> to <b title="">authority start</b>.

      <p>Otherwise, set
      <a href="#concept-url-scheme" title="concept-url-scheme">scheme</a> to
      <var title="">base</var>'s <a href="#concept-url-scheme" title="concept-url-scheme">scheme</a>,
      <a href="#concept-url-host" title="concept-url-host">host</a> to
      <var title="">base</var>'s <a href="#concept-url-host" title="concept-url-host">host</a>,
      <a href="#concept-url-port" title="concept-url-port">port</a> to
      <var title="">base</var>'s <a href="#concept-url-port" title="concept-url-port">port</a>,
      <var title="">state</var> to <b title="">hierarchical path start</b>,
      and rerun this state machine for <var title="">c</var>.

     <dt>"<code title="">?</code>"
     <dd><p>Set <a href="#concept-url-scheme" title="concept-url-scheme">scheme</a> to
     <var title="">base</var>'s <a href="#concept-url-scheme" title="concept-url-scheme">scheme</a>,
     <a href="#concept-url-host" title="concept-url-host">host</a> to
     <var title="">base</var>'s <a href="#concept-url-host" title="concept-url-host">host</a>,
     <a href="#concept-url-port" title="concept-url-port">port</a> to
     <var title="">base</var>'s <a href="#concept-url-port" title="concept-url-port">port</a>,
     <a href="#concept-url-path" title="concept-url-path">path</a> to
     <var title="">base</var>'s <a href="#concept-url-path" title="concept-url-path">path</a>,
     <a href="#concept-url-query" title="concept-url-query">query</a> to "<code title="">?</code>",
     and <var title="">state</var> to <b title="">query</b>.

     <dt>"<code title="">#</code>"
     <dd><p>Set <a href="#concept-url-scheme" title="concept-url-scheme">scheme</a> to
     <var title="">base</var>'s <a href="#concept-url-scheme" title="concept-url-scheme">scheme</a>,
     <a href="#concept-url-host" title="concept-url-host">host</a> to
     <var title="">base</var>'s <a href="#concept-url-host" title="concept-url-host">host</a>,
     <a href="#concept-url-port" title="concept-url-port">port</a> to
     <var title="">base</var>'s <a href="#concept-url-port" title="concept-url-port">port</a>,
     <a href="#concept-url-path" title="concept-url-path">path</a> to
     <var title="">base</var>'s <a href="#concept-url-path" title="concept-url-path">path</a>,
     <a href="#concept-url-query" title="concept-url-query">query</a> to
     <var title="">base</var>'s <a href="#concept-url-query" title="concept-url-query">query</a>,
     <a href="#concept-url-fragment" title="concept-url-fragment">fragment</a> to
     "<code title="">#</code>", and <var title="">state</var> to
     <b title="">fragment</b>.

     <dt>Otherwise
     <dd><p>Set <a href="#concept-url-scheme" title="concept-url-scheme">scheme</a> to
     <var title="">base</var>'s <a href="#concept-url-scheme" title="concept-url-scheme">scheme</a>,
     <a href="#concept-url-host" title="concept-url-host">host</a> to
     <var title="">base</var>'s <a href="#concept-url-host" title="concept-url-host">host</a>,
     <a href="#concept-url-port" title="concept-url-port">port</a> to
     <var title="">base</var>'s <a href="#concept-url-port" title="concept-url-port">port</a>,
     <a href="#concept-url-path" title="concept-url-path">path</a> to
     <var title="">base</var>'s <a href="#concept-url-path" title="concept-url-path">path</a>, then
     remove <a href="#concept-url-path" title="concept-url-path">path</a>'s last string, set
     <var title="">state</var> to <b title="">hierarchical path start</b>,
     and rerun this state machine for <var title="">c</var>.
    </dl>

   <dt><b title="">authority start</b>
   <dd><p>If <var title="">c</var> is neither "<code title="">/</code>" nor
   "<code title="">\</code>", set <var title="">state</var> to
   <b title="">authority</b>, and rerun this state machine for
   <var title="">c</var>.

   <dt><b title="">authority</b>
   <dd>
    <p>Based on <var title="">c</var>:
    <dl class="switch">
     <dt>"<code title="">@</code>"
     <dd>
      <ol>
       <li><p>If the <var title="">@ flag</var> is set, append
       "<code title="">%40</code>" to
       <a href="#concept-url-userinfo" title="concept-url-userinfo">userinfo</a>.

       <li><p>Set the <var title="">@ flag</var>.

       <li><p>Append each code point in <var title="">buffer</var>,
       <a href="#percent-escaped">percent escaped</a>, to
       <a href="#concept-url-userinfo" title="concept-url-userinfo">userinfo</a>

       <li><p>Set <var title="">buffer</var> to the empty string.
      </ol>
     <dt><a href="#eof-code-point">EOF code point</a>
     <dt>"<code title="">/</code>"
     <dt>"<code title="">\</code>"
     <dt>"<code title="">?</code>"
     <dt>"<code title="">#</code>"
     <dd><p>Rerun this state machine for all code points in
     <var title="">buffer</var>, set <var title="">buffer</var> to the empty
     string, and <var title="">state</var> to <b title="">host</b>.

     <dt>Otherwise
     <dd><p>Append <var title="">c</var> to <var title="">buffer</var>.
    </dl>

   <dt><b title="">host</b>
   <dt><b title="">hostname</b>
   <dd>
    <ol>
     <li><p>If <var title="">c</var> is "<code title="">:</code>" and
     the <var title="">[] flag</var> is unset, set
     <a href="#concept-url-host" title="concept-url-host">host</a> to <var title="">buffer</var>,
     <!-- XXX host normalize -->
     <var title="">buffer</var> to the empty string, <var title="">state</var>
     to <b title="">port</b>, and then only if <var title="">override</var> is
     <b title="">hostname</b>, terminate these steps.

     <li><p>Otherwise, if <var title="">c</var> is one of
     <a href="#eof-code-point">EOF code point</a>, "<code title="">/</code>",
     "<code title="">\</code>", "<code title="">?</code>", or
     "<code title="">#</code>", set
     <a href="#concept-url-host" title="concept-url-host">host</a> to <var title="">buffer</var>,
     <!-- XXX host normalize -->
     <var title="">buffer</var> to the empty string, <var title="">state</var>
     to <b title="">hierarchical path start</b>, and then only if
     <var title="">override</var> is given, terminate these steps, or otherwise
     rerun this state machine for <var title="">c</var>.

     <li>
      <p>Otherwise, if <var title="">c</var> is none of U+0009, U+000A, and
      U+000D, run these substeps:

      <ol>
       <li><p>If <var title="">c</var> is "<code title="">[</code>", set the
       <var title="">[] flag</var>.

       <li><p>If <var title="">c</var> is "<code title="">]</code>", unset the
       <var title="">[] flag</var>.

       <li><p>Append <var title="">c</var> to <var title="">buffer</var>.
      </ol>
    </ol>

   <dt><b title="">port</b>
   <dd>
    <ol>
     <li><p>If <var title="">c</var> is in the range U+0030 through to U+0039,
     append <var title="">c</var> to <var title="">buffer</var>.

     <li>
      <p>Otherwise, if <var title="">c</var> is one of
      <a href="#eof-code-point">EOF code point</a>, "<code title="">/</code>",
      "<code title="">\</code>", "<code title="">?</code>", or
      "<code title="">#</code>", or <var title="">override</var> is given, run
      these substeps:
      <ol>
       <li><p class="XXX">parse buffer and set port

       <li><p>If <var title="">override</var> is given, terminate this
       algorithm.

       <li><p>Set <var title="">buffer</var> to the empty string,
       <var title="">state</var> to <b title="">hierarchical path start</b>, and
       rerun this state machine for <var title="">c</var>.
      </ol>

     <li><p>Otherwise, <a href="#invalidate">invalidate</a>.
    </ol>

   <dt><b title="">path</b>
   <dd>
    <ol>
     <li><p>Append an empty string to
     <a href="#concept-url-path" title="concept-url-path">path</a>.

     <li><p>If <var title="">override</var> is not given and <var title="">c</var>
     is "<code title="">#</code>", set
     <a href="#concept-url-fragment" title="concept-url-fragment">fragment</a> to
     "<code title="">#</code>" and <var title="">state</var> to
     <b title="">fragment</b>.

     <li><p>Otherwise, if <var title="">c</var> is not the
     <a href="#eof-code-point">EOF code point</a>, append <var title="">c</var>,
     <a href="#percent-escaped">percent escaped</a>, to the only string in
     <a href="#concept-url-path" title="concept-url-path">path</a>.
    </ol>

   <dt><b title="">hierarchical path start</b>
   <dd><p>Set <var title="">state</var> to <b title="">hierarchical path</b> and
   if <var title="">c</var> is neither "<code title="">/</code>" nor
   "<code title="">\</code>", rerun this state machine for <var title="">c</var>.

   <dt><b title="">hierarchical path</b>
   <dd>
    <ol>
     <li>
      <p>If either <var title="">c</var> is one of
      <a href="#eof-code-point">EOF code point</a>, "<code title="">/</code>", and
      "<code title="">\</code>", or <var title="">override</var> is not given and
      <var title="">c</var> is "<code title="">?</code>" or
      "<code title="">#</code>", run these substeps:
      <ol>
       <li><p>If <var title="">buffer</var> is "<code title="">..</code>" and
       <var title="">c</var> is one of <a href="#eof-code-point">EOF code point</a>,
       "<code title="">/</code>", and "<code title="">\</code>", set the last
       string in <a href="#concept-url-path" title="concept-url-path">path</a> to the empty
       string.

       <li><p>Otherwise, if <var title="">buffer</var> is
       "<code title="">..</code>", remove the last string from
       <a href="#concept-url-path" title="concept-url-path">path</a>.

       <li><p>Otherwise, if <var title="">buffer</var> is
       "<code title="">.</code>" and <var title="">c</var> is one of
       <a href="#eof-code-point">EOF code point</a>, "<code title="">/</code>", and
       "<code title="">\</code>", append an empty string to
       <a href="#concept-url-path" title="concept-url-path">path</a>.

       <li><p>Otherwise, if <var title="">buffer</var> is not
       "<code title="">.</code>", append <var title="">buffer</var> to
       <a href="#concept-url-path" title="concept-url-path">path</a>.

       <li><p>Set <var title="">buffer</var> to the empty string.

       <li><p>If <var title="">c</var> is "<code title="">?</code>", set
       <a href="#concept-url-query" title="concept-url-query">query</a> to "<code title="">?</code>",
       and <var title="">state</var> to <b title="">query</b>.

       <li><p>If <var title="">c</var> is "<code title="">#</code>", set
       <a href="#concept-url-fragment" title="concept-url-fragment">fragment</a> to
       "<code title="">#</code>", and <var title="">state</var> to
       <b title="">fragment</b>.
      </ol>

     <li><p>Otherwise, if <var title="">c</var> is none of U+0009, U+000A, and
     U+000D, append <var title="">c</var>, <a href="#percent-escaped">percent escaped</a>, to
     <var title="">buffer</var>.
    </ol>

   <dt><b title="">query</b>
   <dd>
    <ol>
     <li><p>If <var title="">override</var> is not given and <var title="">c</var>
     is "<code title="">#</code>", set
     <a href="#concept-url-fragment" title="concept-url-fragment">fragment</a> to
     "<code title="">#</code>", and state to <b title="">fragment</b>.

     <li><p>Otherwise, if <var title="">c</var> is none of U+0009, U+000A, and
     U+000D, append <var title="">c</var>, <a href="#query-percent-escaped">query percent escaped</a>,
     to <a href="#concept-url-query" title="concept-url-query">query</a>.
    </ol>

   <dt><b title="">fragment</b>
   <dd><p>If <var title="">c</var> is none of U+0009, U+000A, and U+000D,
   append <var title="">c</var>, <a href="#percent-escaped">percent escaped</a>, to
   <a href="#concept-url-fragment" title="concept-url-fragment">fragment</a>.
  </dl>
</ol>



<h2 id="api"><span class="secno">5 </span>API</h2>

<pre class="idl">[<a href="#dom-url" title="dom-URL">Constructor</a>(DOMString <var title="">url</var>, optional (<a href="#url">URL</a> or DOMString)? <var title="">base</var> = null)]
interface <dfn id="url">URL</dfn> {
};
<a href="#url">URL</a> implements <a href="#urlutils">URLUtils</a>;

[NoInterfaceObject]
interface <dfn id="urlutils">URLUtils</dfn> {
  stringifier attribute DOMString <a href="#dom-url-href" title="dom-URL-href">href</a>;
  readonly attribute DOMString <a href="#dom-url-origin" title="dom-URL-origin">origin</a>;

           attribute DOMString <a href="#dom-url-protocol" title="dom-URL-protocol">protocol</a>;
           attribute DOMString <a href="#dom-url-host" title="dom-URL-host">host</a>;
           attribute DOMString <a href="#dom-url-hostname" title="dom-URL-hostname">hostname</a>;
           attribute DOMString <a href="#dom-url-port" title="dom-URL-port">port</a>;
           attribute DOMString <a href="#dom-url-pathname" title="dom-URL-pathname">pathname</a>;
           attribute DOMString <a href="#dom-url-search" title="dom-URL-search">search</a>;
  readonly attribute <a href="#urlquery">URLQuery</a> <a href="#dom-url-query" title="dom-URL-query">query</a>;
           attribute DOMString <a href="#dom-url-hash" title="dom-URL-hash">hash</a>;

  readonly attribute boolean <a href="#dom-url-valid" title="dom-URL-valid">valid</a>;
};</pre>

<p>Any object implementing <a href="#urlutils"><code>URLUtils</code></a> represents a
<a href="#concept-url" title="concept-url">URL</a>. Thus <a href="#url"><code>URL</code></a> represents a
<a href="#concept-url" title="concept-url">URL</a>.

<p>Any object implementing <a href="#urlutils"><code>URLUtils</code></a> also has one associated
<a href="#urlquery"><code>URLQuery</code></a> object.

<p class="note">The <a href="#url"><code>URL</code></a> object and
<a href="#concept-url" title="concept-url">URL</a> share the same name because nothing else
makes much sense and when it comes down to it almost nobody cares.


<h3 id="constructors"><span class="secno">5.1 </span>Constructors</h3> <!-- "constructor" causes dfn.js to fail -->

<p>The
<dfn id="dom-url" title="dom-URL"><code>URL(<var title="">url</var> [, <var title="">base</var>])</code></dfn>
constructor must run these steps:

<ol>
 <li><p>If <var title="">base</var> is a string,
 <a href="#concept-url-parse" title="concept-url-parse">parse</a> <var title="">base</var> and set
 <var title="">base</var> to the result of that algorithm.

 <li><p>If <var title="">base</var> is not null and its
 <a href="#invalid-flag">invalid flag</a> is set, throw a
 "<a href="http://dom.spec.whatwg.org/#invalidstateerror"><code class="external" data-anolis-spec="dom">InvalidStateError</code></a>".

 <li><p><a href="#concept-url-parse" title="concept-url-parse">Parse</a> <var title="">url</var> with
 <var title="">base</var> as <i title="">base</i>, associate it with a new
 <a href="#url"><code>URL</code></a> object, and then return that <a href="#url"><code>URL</code></a> object.
</ol>


<h3 id="interface-urlutils"><span class="secno">5.2 </span>Interface <code title="">URLUtils</code></h3>

<p class="note">The <a href="#urlutils"><code>URLUtils</code></a> interface is not exposed on the
global object. It augments other interfaces, such as <a href="#url"><code>URL</code></a>.

<p>The <dfn id="dom-url-href" title="dom-URL-href"><code>href</code></dfn> attribute must run
these steps:

<ol>
 <li><p>If the <a href="#invalid-flag">invalid flag</a> is set, return
 <a href="#concept-url-input" title="concept-url-input">input</a>.

 <li><p>Let <var title="">output</var> be
 <a href="#concept-url-scheme" title="concept-url-scheme">scheme</a> and "<code title="">:</code>"
 concatenated.

 <li>
  <p>If the <a href="#hierarchical-flag">hierarchical flag</a> is set:

  <ol>
   <li><p>Append "<code title="">//</code>" to <var title="">output</var>.

   <li><p>If <a href="#concept-url-userinfo" title="concept-url-userinfo">userinfo</a> is not the
   empty string, append <a href="#concept-url-userinfo" title="concept-url-userinfo">userinfo</a> and
   "<code title="">@</code>" concatenated to <var title="">output</var>.

   <li><p>Append <a href="#concept-url-host" title="concept-url-host">host</a> to
   <var title="">output</var>.

   <li><p>If <a href="#concept-url-port" title="concept-url-port">port</a> is not
   the empty string, append "<code title="">:</code>" and
   <a href="#concept-url-port" title="concept-url-port">port</a> concatenated to
   <var title="">output</var>.

   <li><p>Append "<code title="">/</code>" concatenated with the strings in
   <a href="#concept-url-path" title="concept-url-path">path</a> (including empty strings),
   separated from each other by "<code title="">/</code>".
  </ol>

 <li><p>If the <a href="#hierarchical-flag">hierarchical flag</a> is unset, append
 <a href="#concept-url-path" title="concept-url-path">path</a>'s only string (if any).

 <li><p>Append <a href="#concept-url-query" title="concept-url-query">query</a> and
 <a href="#concept-url-fragment" title="concept-url-fragment">fragment</a> concatenated to
 <var title="">output</var>, and then return <var title="">output</var>.
</ol>

<p>Setting the <a href="#dom-url-href"><code title="dom-URL-href">href</code></a> attribute must
run these steps:

<ol>
 <li><p><a href="#clear">Clear</a>.

 <li><p>Set <a href="#concept-url-input" title="concept-url-input">input</a> to the given value.

 <li><p><a href="#concept-url-interpret" title="concept-url-interpret">Interpret</a>
 <a href="#concept-url-input" title="concept-url-input">input</a>, with any leading and trailing
 <a class="external" data-anolis-spec="encoding" href="http://encoding.spec.whatwg.org/#space-characters">space characters</a> removed, as
 <i title="">input</i>.
</ol>

<p>The <dfn id="dom-url-origin" title="dom-URL-origin"><code>origin</code></dfn> attribute must
return the <a class="external" data-anolis-spec="origin" href="http://tools.ietf.org/html/rfc6454#section-6.1">Unicode serialization</a> of
the <a href="#concept-url" title="concept-url">URL</a>'s
<a class="external" data-anolis-spec="origin" href="http://tools.ietf.org/html/rfc6454#section-4">origin</a>.
<a href="#refsORIGIN">[ORIGIN]</a>

<p class="note">It returns the Unicode rather than the ASCII serialization for
compatibility with HTML's <code>MessageEvent</code> feature.
<a class="informative" href="#refsHTML">[HTML]</a>

<p>The <dfn id="dom-url-protocol" title="dom-URL-protocol"><code>protocol</code></dfn> attribute
must return <a href="#concept-url-scheme" title="concept-url-scheme">scheme</a> and
"<code title="">:</code>" concatenated.

<p class="note">In case the <a href="#invalid-flag">invalid flag</a> is set this will cause
it to return "<code title="">:</code>".

<p>Setting the <a href="#dom-url-protocol"><code title="dom-URL-protocol">protocol</code></a> attribute must
run these steps:

<ol>
 <li><p>If the <a href="#invalid-flag">invalid flag</a> is set, terminate these steps.

 <li><p><a href="#concept-url-interpret" title="concept-url-interpret">Interpret</a> with the
 given value and "<code title="">:</code>" concatenated as <i title="">input</i>
 and <b title="">scheme start</b> as <i title="">override</i>.
</ol>

<p>The <dfn id="dom-url-host" title="dom-URL-host"><code>host</code></dfn> attribute must run
these steps:

<ol>
 <li><p>If the <a href="#invalid-flag">invalid flag</a> is set, return the empty string.

 <li><p>If <a href="#concept-url-port" title="concept-url-port">port</a> is the empty string,
 return <a href="#concept-url-host" title="concept-url-host">host</a>.

 <li><p>Return <a href="#concept-url-host" title="concept-url-host">host</a>,
 "<code title="">:</code>", and <a href="#concept-url-port" title="concept-url-port">port</a>
 concatenated.
</ol>

<p>Setting the <a href="#dom-url-host"><code title="dom-URL-host">host</code></a> attribute must run these
steps:

<ol>
 <li><p>If the <a href="#invalid-flag">invalid flag</a> is set, or the
 <a href="#hierarchical-flag">hierarchical flag</a> is unset, terminate these steps.

 <li><p><a href="#concept-url-interpret" title="concept-url-interpret">Interpret</a> with the
 given value as <i title="">input</i> and <b title="">host</b> as
 <i title="">override</i>.
</ol>

<p>The <dfn id="dom-url-hostname" title="dom-URL-hostname"><code>hostname</code></dfn> attribute
must return <a href="#concept-url-host" title="concept-url-host">host</a>.

<p>Setting the <a href="#dom-url-hostname"><code title="dom-URL-hostname">hostname</code></a> attribute must
run these steps:

<ol>
 <li><p>If the <a href="#invalid-flag">invalid flag</a> is set, or the
 <a href="#hierarchical-flag">hierarchical flag</a> is unset, terminate these steps.

 <li><p><a href="#concept-url-interpret" title="concept-url-interpret">Interpret</a> with the
 given value as <i title="">input</i> and <b title="">hostname</b> as
 <i title="">override</i>.
</ol>

<p>The <dfn id="dom-url-port" title="dom-URL-port"><code>port</code></dfn> attribute must return
<a href="#concept-url-port" title="concept-url-port">port</a>.

<p>Setting the <a href="#dom-url-port"><code title="dom-URL-port">port</code></a> attribute must run these
steps:

<ol>
 <li><p>If the <a href="#invalid-flag">invalid flag</a> is set, or the
 <a href="#hierarchical-flag">hierarchical flag</a> is unset, terminate these steps.

 <li><p><a href="#concept-url-interpret" title="concept-url-interpret">Interpret</a> with the
 given value as <i title="">input</i> and <b title="">port</b> as
 <i title="">override</i>.
</ol>

<p>The <dfn id="dom-url-pathname" title="dom-URL-pathname"><code>pathname</code></dfn> attribute
must run these steps:

<ol>
 <li><p>If the <a href="#invalid-flag">invalid flag</a> is set, return the empty string.

 <li><p>If the <a href="#hierarchical-flag">hierarchical flag</a> is unset, return
 <a href="#concept-url-path" title="concept-url-path">path</a>'s only string.

 <li><p>Return "<code title="">/</code>" concatenated with the strings in
 <a href="#concept-url-path" title="concept-url-path">path</a> (including empty strings),
 separated from each other by "<code title="">/</code>".
</ol>

<p>Setting the <a href="#dom-url-pathname"><code title="dom-URL-pathname">pathname</code></a> attribute must
run these steps:

<ol>
 <li><p>If the <a href="#invalid-flag">invalid flag</a> is set, or the
 <a href="#hierarchical-flag">hierarchical flag</a> is unset, terminate these steps.

 <li><p>Set <a href="#concept-url-path" title="concept-url-path">path</a> to the empty list.

 <li><p><a href="#concept-url-interpret" title="concept-url-interpret">Interpret</a> with the
 given value as <i title="">input</i> and <b title="">hierarchical path start</b>
 as <i title="">override</i>.
</ol>

<p>The <dfn id="dom-url-search" title="dom-URL-search"><code>search</code></dfn> attribute must
run these steps:

<ol>
 <li><p>If the <a href="#invalid-flag">invalid flag</a> is set, or
 <a href="#concept-url-query" title="concept-url-query">query</a> is either the empty string or
 "<code title="">?</code>", return the empty string.

 <li><p>Return <a href="#concept-url-query" title="concept-url-query">query</a>.
</ol>

<p>Setting the <a href="#dom-url-search"><code title="dom-URL-search">search</code></a> attribute must run
these steps:

<ol>
 <li><p>If the <a href="#invalid-flag">invalid flag</a> is set, or the
 <a href="#hierarchical-flag">hierarchical flag</a> is unset, terminate these steps.

 <li><p>Let <var title="">input</var> be the given value with a single leading
 "<code title="">?</code>" removed, if any.

 <li><p><a href="#concept-url-interpret" title="concept-url-interpret">Interpret</a> with
 <var title="">input</var> as <i title="">input</i> and <b title="">query</b> as
 <i title="">override</i>.
</ol>

<p>The <dfn id="dom-url-query" title="dom-URL-query"><code>query</code></dfn> attribute must
return the associated <a href="#urlquery"><code>URLQuery</code></a> object.

<p>The <dfn id="dom-url-hash" title="dom-URL-hash"><code>hash</code></dfn> attribute must run
these steps:

<ol>
 <li><p>If the <a href="#invalid-flag">invalid flag</a> is set, or
 <a href="#concept-url-fragment" title="concept-url-fragment">fragment</a> is either the empty string
 or "<code title="">#</code>", return the empty string.

 <li><p>Return <a href="#concept-url-fragment" title="concept-url-fragment">fragment</a>.
</ol>

<p>Setting the <a href="#dom-url-hash"><code title="dom-URL-hash">hash</code></a> attribute must run these
steps:

<ol>
 <li><p>If the <a href="#invalid-flag">invalid flag</a> is set, or the
 <a href="#hierarchical-flag">hierarchical flag</a> is unset, terminate these steps.

 <li><p>Let <var title="">input</var> be the given value with a single leading
 "<code title="">#</code>" removed, if any.

 <li><p><a href="#concept-url-interpret" title="concept-url-interpret">Interpret</a> with
 <var title="">input</var> as <i title="">input</i> and <b title="">fragment</b> as
 <i title="">override</i>.
</ol>

<p>The <dfn id="dom-url-valid" title="dom-URL-valid"><code>valid</code></dfn> attribute
must return false if the <a href="#invalid-flag">invalid flag</a> is set, or true
otherwise.


<h3 id="interface-urlquery"><span class="secno">5.3 </span>Interface <code title="">URLQuery</code></h3>

<pre class="idl">interface <dfn id="urlquery">URLQuery</dfn> {
  DOMString? <span title="dom-URLQuery-get">get</span>(DOMString <var title="">name</var>);
  sequence&lt;DOMString&gt; <span title="dom-URLQuery-getAll">getAll</span>(DOMString <var title="">name</var>);
  void <span title="dom-URLQuery-set">set</span>(DOMString name, (sequence&lt;DOMString&gt; or DOMString) <var title="">value</var>);
  void <span title="dom-URLQuery-delete">delete</span>(DOMString <var title="">name</var>);
};</pre>

<p class="XXX">...



<h2 class="no-num" id="references">References</h2>
<div id="anolis-references"><dl><dt id="refsENCODING">[ENCODING]
<dd><cite><a href="http://encoding.spec.whatwg.org/">Encoding Standard</a></cite>, Anne van Kesteren. WHATWG.

<dt id="refsHTML">[HTML]
<dd>(Non-normative) <cite><a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/">HTML</a></cite>, Ian Hickson. WHATWG.

<dt id="refsORIGIN">[ORIGIN]
<dd><cite><a href="http://tools.ietf.org/html/rfc6454">The Web Origin Concept</a></cite>, Adam Barth. IETF.

<dt id="refsRFC2119">[RFC2119]
<dd><cite><a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a></cite>, Scott Bradner. IETF.

<dt id="refsRFC3986">[RFC3986]
<dd><cite><a href="http://tools.ietf.org/html/rfc3986">Uniform Resource Identifier (URI): Generic Syntax</a></cite>, Tim Berners-Lee, Roy Fielding and Larry Masinter. IETF.

<dt id="refsRFC3987">[RFC3987]
<dd><cite><a href="http://tools.ietf.org/html/rfc3987">Internationalized Resource Identifiers (IRIs)</a></cite>, Martin Dürst and Michel Suignard. IETF.

</dl></div>



<h2 class="no-num" id="acknowledgments">Acknowledgments</h2>

<p>Thanks to
Alexandre Morgaut,
Erik Arvidsson,
Glenn Maynard,
James Graham,
Simon Pieters, and
Tab Atkins
for being awesome!



<script id="head" src="http://www.whatwg.org/specs/web-apps/current-work/dfn.js"></script>
